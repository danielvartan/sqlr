wos <- read_ref()
writeLines(names(wos), tempfile())
head(wos$file, 10)
View(temp)
head(scopus$C7, 10)
head(unique(scopus$C7, 10))
head(unique(scopus$C3, 10))
head(unique(scopus$C3, 5))
head(unique(scopus$Y2, 5))
head(unique(scopus$A4, 5))
head(unique(scopus$CY, 5))
head(unique(scopus$BMI, 5))
head(unique(scopus$A2, 5))
head(unique(scopus$WMBG, 5))
temp <- head(wos, 10)
View(temp)
head(unique(wos$MA, 5))
head(unique(wos$A1, 5))
head(unique(wos$ED, 5))
source('C:/Midia/GitHub/sqlr/data-raw/ris_tags.R')
ris_tags(TRUE)
devtools::load_all(".")
rm(ris_tags())
rm(ris_tags)
wos <- read_ref(lookup = "wos")
temp <- head(wos, 10)
View(temp)
wos <- read_ref(lookup = "scopus")
scopus <- read_ref(lookup = "scopus")
temp <- head(scopus, 10)
?dplyr::mutate
use_r("create_reference")
dplyr::tibble()
?list.dirs()
?system.file
devtools::load_all(".")
raw_data("reference")
devtools::load_all(".")
raw_data("reference")
devtools::load_all(".")
install.packages(c("httpuv", "installr", "rmarkdown", "settings"))
rstudioapi::getActiveProject()
spelling::spell_check_package()
spelling::update_wordlist()
devtools::install()
devtools::load_all(".")
raw_data()
system.file(package = "sqlr")
system.file("inst/extdate", package = "sqlr")
system.file("inst/extdata", package = "sqlr")
devtools::load_all(".")
raw_data()
raw_data("reference")
raw_data("search_history")
system.file(package= "dplyer")
system.file(package= "dplyr")
system.file("inst/extdata", package= "dplyr")
system.file("inst/extdata", package= "sqlr.mcycle")
system.file("inst/extdata", package= "sqlr3")
system.file("inst/extdata", package= "sqlr.per3")
system.file(package= "sqlr.per3")
devtools::install()
devtools::install()
devtools::load_all(".")
normalize_extdata()
raw_data("reference")
files <- raw_data("reference", package = package)
raw_data("reference", files)
package <- "sqlr"
files <- raw_data("reference", package = package)
raw_data("reference", files)
devtools::load_all(".")
raw_data("reference", files)
devtools::load_all(".")
raw_data("reference", files)
files <- raw_data("reference", files)
stringr::str_extract(files, "(?=reference_).+")
stringr::str_extract(files, "(?<=reference_).+")
stringr::str_extract(files, "(?<=reference_).+(?=_)")
stringr::str_extract(files, "(?<=reference_).+(?=_en|pt|es)")
system.file(package = "sqlr.per3")
system.file(package = "sqlr")
system.file("inst/extdata" package = "sqlr")
system.file("inst/extdata", package = "sqlr")
devtools::load_all(".")
normalize_extdata()
devtools::load_all(".")
normalize_extdata()
normalize_extdata()
pattern <- "(?<=reference_).+(?=_en|pt|es)"
stringr::str_extract(files, pattern)
lookup <- stringr::str_extract(files, pattern)
args(stringr::str_replace_all)
stringr::str_replace_all(lookup, "web-of-science", "wos")
files[1]
i <- files[1]
files <- raw_data("reference", package = package)
files
i <- files[1]
i
pattern <- "(?<=reference_).+(?=_en|pt|es)"
lookup <- stringr::str_extract(files, pattern)
lookup <- stringr::str_replace_all(lookup, "web-of-science", "wos")
lookup
pattern <- "(?<=reference_).+(?=_en|pt|es)"
lookup <- stringr::str_extract(i, pattern)
lookup <- stringr::str_replace_all(lookup, "web-of-science", "wos")
lookup
pattern <- "(?<=reference_).+(?=_en|pt|es)"
lookup <- stringr::str_extract(i, pattern)
lookup <- stringr::str_replace_all(lookup, "^web-of-science$", "wos")
i
files
i <- files[3]
pattern <- "(?<=reference_).+(?=_en|pt|es)"
lookup <- stringr::str_extract(i, pattern)
lookup <- stringr::str_replace_all(lookup, "^web-of-science$", "wos")
lookup
i <- raw_data("reference", i)
i
data <- read_ref(i, lookup = lookup)
out <- dplyr::tibble()
out <- dplyr::bind_rows(out, data)
devtools::load_all(".")
ref <- read_ref("sqlr")
ref <- read_ref_extdata("sqlr")
names(ref)
uniqueref$file)
unique(ref$file)
devtools::load_all(".")
normalize_extdata()
names(ref)
?temp <- dplyr::slice_sample()
?dplyr::slice_sample()
temp <- dplyr::slice_sample(ref, 10)
temp <- dplyr::slice_sample(ref, n = 10)
View(temp)
temp$file
rstudioapi::getActiveProject()
stringr::str_extract(rstudioapi::getActiveProject(), "(?>=/)[a-zA-Z0-9.]*$")
stringr::str_extract(rstudioapi::getActiveProject(), "(?>=\/)[a-zA-Z0-9.]*$")
basename(rstudioapi::getActiveProject)
rstudioapi::getActiveProject
rstudioapi::getActiveProject()
basename(rstudioapi::getActiveProject())
basename(rstudioapi::getActiveProject())
write_metadata("1x6Aj8cXl9qFtpXq48Q6zdmT-w9EEqNG1iVQcKVRhgKM")
devtools::load_all(".")
sheets
?googlesheets4::range_write
paste0(LETTERS[grep("^query$", names(search))], "2")
sheets$reference$id
sheets$reference$sheet
package = NULL
checkmate::assert_string(package, null.ok = TRUE)
if (is.null(package)) package <- get_package_name()
assert_namespace(package)
assert_data("sheets", package, alert = "gipso_1")
utils::data("sheets", package = package, envir = environment())
View(sheets)
googlesheets4::range_write(sheets$reference$id, ref, sheets$reference$sheet,
"A1", col_names = TRUE, reformat = FALSE)
readr::write_csv(ref, tempfile())
normalizePath(tempdir(), "/")
googlesheets4::range_write(sheets$reference$id, head(ref, 1000),
sheets$reference$sheet, "A1",
col_names = TRUE, reformat = FALSE)
cols <- c("type", "doi", "pmid", "author", "year", "title", "abstract",
"keyword", "journal", "place_published", "volume", "issue",
"start_page", "end_page")
which(cols %in% names(ref)
)
data <- ref
data <- dplyr::select(dplyr::all_of(cols))
data <- ref %>% dplyr::select(dplyr::all_of(cols))
googlesheets4::range_write(sheets$reference$id, head(data, 1000),
sheets$reference$sheet, "A1",
col_names = TRUE, reformat = FALSE)
cols <- c("type", "doi", "pmid", "author", "year", "title", "abstract",
"keyword", "journal", "place_published", "volume", "issue",
"start_page", "end_page", "provider", "file")
cols <- cols[which(cols %in% names(ref))]
data <- ref %>% dplyr::select(dplyr::all_of(cols))
googlesheets4::range_write(sheets$reference$id, head(data, 1000),
sheets$reference$sheet, "A1",
col_names = TRUE, reformat = FALSE)
cols <- c("type", "doi", "pmid", "author", "year", "title", "abstract",
"keyword", "journal", "place_published", "volume", "issue",
"start_page", "end_page", "provider", "file")
cols <- cols[which(cols %in% names(ref))]
data <- ref %>% dplyr::select(dplyr::all_of(cols))
googlesheets4::range_write(sheets$reference$id, data,
sheets$reference$sheet, "A1",
col_names = TRUE, reformat = FALSE)
head(temp, 20)
temp <- head(data, 10)
temp[1]
temp[,1]
temp[1,]
googlesheets4::sheet_append(sheets$reference$id, data[5,],
sheets$reference$sheet)
nrow(data)
nrow(data) / 5000
round?
?round
ceiling(nrow(data) / 5000)
sheet_properties(sheets$reference$id)
googlesheets4::sheet_properties(sheets$reference$id)
properties <- googlesheets4::sheet_properties(sheets$reference$id)
dplyr::filter(properties, name = sheets$reference$sheet)
dplyr::filter(properties, name == sheets$reference$sheet)
properties <- dplyr::filter(properties, name == sheets$reference$sheet)
properties$grid_rows
properties$grid_rows + 5000
args(seq)
?seq
nrow(data)
nrow(data) - 5000
temp
temp[seq(1, 2)]
temp
temp[seq(1, 2),]
temp[seq(3, 5),]
seq(3, 5)
googlesheets4::range_write(sheets$reference$id, data[seq(5000),],
sheets$reference$sheet, "A1",
col_names = TRUE, reformat = FALSE)
x <- "dasdaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
nchar(x)
stringr::str_sub(x, 1, 10)
x <- c("dssssssssssssssssssssssssssssss", "dsaaaaaaaaaaaaaaaaaa")
stringr::str_sub(x, 1, 5)
str_subset <- function(x) {
dplyr::case_when(
nchar(x) >= 50000 ~ stringr::str_sub(x, 1, 49999),
TRUE, x)
}
?across
str_subset <- function(x) {
dplyr::case_when(
nchar(x) >= 50000 ~ stringr::str_sub(x, 1, 49999),
TRUE, x)
}
data <- dplyr::mutate(data, across(.fns = str_subset))
dplyr::case_when(
nchar(x) >= 50000 ~ stringr::str_sub(x, 1, 49999),
TRUE, x)
x
nchar(x) >= 50000
dplyr::case_when(
nchar(x) >= 50000 ~ stringr::str_sub(x, 1, 49999),
TRUE ~ x
)
str_subset <- function(x) {
dplyr::case_when(
nchar(x) >= 50000 ~ stringr::str_sub(x, 1, 49999),
TRUE ~ x
)
}
data <- dplyr::mutate(data, across(.fns = str_subset))
googlesheets4::range_write(sheets$reference$id, data[seq(5000),],
sheets$reference$sheet, "A1",
col_names = TRUE, reformat = FALSE)
temp[1000, ]
temp[seq(1000), ]
nrow(temp[seq(1000), ])
get_ref_rows <- function() {
properties <- googlesheets4::sheet_properties(sheets$reference$id)
properties <- dplyr::filter(properties, name == sheets$reference$sheet)
properties$grid_rows
}
rows <- get_ref_rows()
rows
nrow(data)
cols <- c("id", "type", "doi", "pmid", "author", "year", "title",
"abstract", "keyword", "journal", "place_published", "volume",
"issue", "start_page", "end_page", "provider", "file")
cols <- cols[which(cols %in% names(ref))]
cols
?dplyr::mutate
dplyr::mutate(data, id = seq(1, nrows(data)))
dplyr::mutate(data, id = seq(1, nrow(data)))
temp <- dplyr::mutate(temp, id = seq(1, nrow(data)))
temp <- dplyr::mutate(temp, id = seq(1, nrow(temp)))
temp
dplyr::relocate(temp, id)
data %>% dplyr::mutate(reference_id = seq(1, nrow(data))) %>%
dplyr::relocate(reference_id)
data <- data %>% dplyr::mutate(reference_id = seq(1, nrow(data))) %>%
dplyr::relocate(reference_id)
tail(data, 5)
googlesheets4::range_write(sheets$reference$id, data[seq(5000),],
sheets$reference$sheet, "A1",
col_names = TRUE, reformat = FALSE)
rows <- get_ref_rows()
rows
while (rows < nrow(data)) {
if (rows + 5000 > nrow(data)) {
from <- rows
to <- nrow(data)
} else if (rows + 5000 <= nrow(data)) {
from <- rows
to <- rows + 5000
}
googlesheets4::sheet_append(sheets$reference$id,
data[seq(from, to),],
sheets$reference$sheet)
rows <- get_ref_rows()
}
data[nrow(data), ]
x <- c("A", "B", NA, "A", NA)
duplicated(x, incomparables = NA)
which(duplicated(x, incomparables = NA))
doi <- stringr::str_extract(data$doi, pattern_doi)
pattern_doi <- "10.\\d{4,9}/[-._;()/:a-z0-9A-Z]+"
doi <- stringr::str_extract(data$doi, pattern_doi)
dup_length <- length(duplicated(doi, incomparables = NA))
head(doi, 10)
length(duplicated(head(doi, 10), incomparables = NA))
duplicated(head(doi, 10), incomparables = NA)
dup_length <- length(which(duplicated(doi, incomparables = NA)))
21184 - 8997
8997 / 21184
cols <- c("id", "criteria_id", "trial_id", "source_id", "search_id",
"type", "doi", "pmid", "author", "year", "title",
"abstract", "keyword", "journal", "place_published", "volume",
"issue", "start_page", "end_page", "provider", "file")
cols <- cols[which(cols %in% names(ref))]
cols
data <- data %>% dplyr::mutate(reference_id = seq(1, nrow(data)),
criteria_id = as.character(NA),
trial_id = as.character(NA),
source_id = as.integer(NA),
search_id = as.integer(NA)) %>%
dplyr::relocate(reference_id, criteria_id, trial_id, source_id,
search_id)
head(data, 10)
args(dplyr::if_else)
data <- data %>%         dplyr::mutate(reference_id = seq(1, nrow(data)),
criteria_id = as.character(NA),
trial_id = as.character(NA),
source_id = as.integer(NA),
search_id = as.integer(NA),
doi = stringr::str_extract(data$doi, pattern_doi))
?dplyr::distinct
data <- data %>% dplyr::mutate(
length = dplyr::n_distinct(dplyr::c_across(-.data$ID)))
data <- data %>% dplyr::mutate(
length = dplyr::n_distinct(dplyr::c_across(-.data$reference_id)))
data <- ref %>%
dplyr::mutate(
length = dplyr::n_distinct(dplyr::c_across(-.data$ID))) %>%
dplyr::mutate(reference_id = seq(1, nrow(data)),
criteria_id = as.character(NA),
trial_id = as.character(NA),
source_id = as.integer(NA),
search_id = as.integer(NA),
doi = stringr::str_extract(data$doi, pattern_doi)) %>%
dplyr::relocate(reference_id, criteria_id, trial_id, source_id,
search_id)
data <- ref %>%
dplyr::mutate(
length = dplyr::n_distinct(dplyr::c_across())) %>%
dplyr::mutate(reference_id = seq(1, nrow(data)),
criteria_id = as.character(NA),
trial_id = as.character(NA),
source_id = as.integer(NA),
search_id = as.integer(NA),
doi = stringr::str_extract(data$doi, pattern_doi)) %>%
dplyr::relocate(reference_id, criteria_id, trial_id, source_id,
search_id)
head(data)
head(data$length, 10)
data <- ref %>%
dplyr::rowwise() %>%
dplyr::mutate(
length = dplyr::n_distinct(dplyr::c_across())) %>%
dplyr::ungroup() %>%
dplyr::mutate(reference_id = seq(1, nrow(data)),
criteria_id = as.character(NA),
trial_id = as.character(NA),
source_id = as.integer(NA),
search_id = as.integer(NA),
doi = stringr::str_extract(data$doi, pattern_doi)) %>%
dplyr::relocate(reference_id, criteria_id, trial_id, source_id,
search_id)
head(data$length, 10)
temp <- head(data, 1)
View(temp)
?dplyr::n_distinct
stringr::str_extract("10.1016/j.cobeha.2015.11.003[doi]", pattern_doi)
stringr::str_extract("10.1016/j.cobeha.2015.11.003(doi)", pattern_doi)
duplicated(head(data$length, 10))
?duplicated
which(?duplicated)
which(duplicated(head(data$length, 10)))
args(dplyr::if_else)
?dplyr::arrange
data <- data %>% dplyr::arrange(dplyr::desc(length)) %>%
dplyr::mutate(criteria_id = dplyr::if_else(
duplicated(doi), "DUP", as.character(NA)))
head(data$length)
temp <- head(data , 100)
View(temp)
temp <- tail(data , 100)
dplyr::arrange(dplyr::desc(length)) %>%
dplyr::mutate(criteria_id = dplyr::if_else(
duplicated(doi, incomparables = NA), "DUP", as.character(NA)))
5384L %in% which(duplicated(data$doi))
data <- data %>%
data <- data %>%         dplyr::arrange(dplyr::desc(length)) %>%
dplyr::mutate(criteria_id = dplyr::if_else(
duplicated(doi, incomparables = NA), "DUP", as.character(NA)))
temp <- tail(data , 100)
5384L %in% which(duplicated(data$doi, incomparables = NA))
which(duplicated(data$doi == 10.1155/2015/806257))
which(duplicated(data$doi == "10.1155/2015/806257"))
which(data$doi == "10.1155/2015/806257")
which(data$doi == "10.1155/2015/563236")
which(data$doi == "10.1155/2019/5321864")
which(data$doi == "
10.1155/2012/567639")
which(data$doi == "10.1155/2012/567639")
which(data$doi == "10.1155/2014/593560")
temp <- data[which(data$doi == "10.1155/2012/567639"),]
names(data)
data <- data %>%         dplyr::arrange(dplyr::desc(length)) %>%
dplyr::mutate(criteria_id = dplyr::case_when(
duplicated(doi, incomparables = NA) ~ "DUP",
duplicated(pmid, incomparables = NA) ~ "DUP",
TRUE ~ as.character(NA))
)
temp <- tail(data , 100)
length(which(!is.na(data$criteria_id)))
length(which(!is.na(data$criteria_id))) / 21184
temp <- data[which(data$doi == "10.1155/2012/567639"),]
data <- data %>% dplyr::arrange(reference_id)
head(data, 5)
str_subset <- function(x) {
dplyr::case_when(
nchar(x) >= 50000 ~ stringr::str_sub(x, 1, 49999),
TRUE ~ x
)
}
cols <- c("reference_id", "criteria_id", "trial_id", "source_id",
"search_id", "type", "doi", "pmid", "author", "year", "title",
"abstract", "keyword", "journal", "place_published", "volume",
"issue", "start_page", "end_page", "length", "provider", "file")
cols <- cols[which(cols %in% names(ref))]
data <- data %>%
dplyr::select(dplyr::all_of(cols)) %>%
dplyr::mutate(across(.fns = str_subset))
head(unique(data$pmid))
pattern_pmid <- "^\\d$"
stringr::str_detect("124545", pattern_pmid)
pattern_pmid <- "^\\d+$"
stringr::str_detect("124545", pattern_pmid)
stringr::str_detect("124545a", pattern_pmid)
stringr::str_detect(" 124545", pattern_pmid)
stringr::str_detect("124545", pattern_pmid)
stringr::str_extract(c("3232", "dd3232"), pattern_pmid)
devtools::load_all(".")
devtools::load_all(".")
?dplyr::relocate
bkp <- ref
data <- ref
rm(ref)
devtools::load_all(".")
data <- identify_duplicates(data)
data <- data %>% tidy_reference()
data <- data %>% assign_ref_ids()
head(data)
temp <- tail(data, 10)
View(temp)
file <- paste0("./data/", "reference", ".rda")
file
?save
devtools::load_all(".")
out <- data
rm(data)
rm(temp)
rm(file)
out %>% write_reference(package)
package <- get_package_name()
out %>% write_reference(package)
devtools::load_all(".")
out %>% write_reference(package)
alert("Saving the reference table...", combined_styles = c(gray))
alert("Saving the reference table...", combined_styles = c("gray"))
crayonize("test", combined_styles = "gray")
crayonize("test", combined_styles = "grey")
crayonize("test", combined_styles = "silver")
cat(crayonize("test", combined_styles = "silver"))
alert("Saving the reference table...", combined_styles = c("silver"))
require_namespace("crayon", quietly = TRUE)
print(require_namespace("crayon", quietly = TRUE))
devtools::load_all(".")
alert("Saving the reference table...", combined_styles = c("silver"))
alert("* Saving the reference table...", combined_styles = c("silver"))
devtools::load_all(".")
out %>% write_reference(package)
devtools::load_all(".")
out %>% write_reference(package)
?across
devtools::load_all(".")
out %>% write_reference(package)
devtools::load_all(".")
alert("*** Writing the reference table to the package ***",
combined_styles = c("silver"))
alert("* Writing the reference table to the package *",
combined_styles = c("silver"))
View(head(reference, 10))
